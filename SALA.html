<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sala de Bate-Papo</title>
  <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('https://img.freepik.com/premium-vector/playful-favela-doodle-vector-art-illustration-with-bold-colors-graffiti-white-background_992796-629.jpg?w=2000') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
    }
    .chat-container {
      max-width: 800px;
      margin: 40px auto;
      background: rgba(255,255,255,0.95);
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.10);
      padding: 32px;
      display: flex;
      flex-direction: column;
      height: 80vh;
    }
    .messages {
      flex: 1;
      overflow-y: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 18px;
      margin-bottom: 18px;
      background: #f3f4f6;
      font-size: 1.2em;
    }
    .message {
      margin-bottom: 12px;
    }
    .message span.username {
      font-weight: bold;
      margin-right: 6px;
      cursor: pointer;
      text-decoration: none;
      transition: color 0.2s;
    }
    .message span.username:hover {
      color: #d32f2f;
      text-decoration: none;
    }
    .audio-message {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    .input-area {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }
    .input-area input[type="text"] {
      flex: 1;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1.2em;
    }
    .input-area button {
      padding: 16px 32px;
      border-radius: 8px;
      border: none;
      background: #2563eb;
      color: #fff;
      font-size: 1.2em;
      cursor: pointer;
      transition: background 0.2s;
    }
    .input-area button:hover {
      background: #60a5fa;
      color: #222;
    }
    .input-area select,
    .input-area input[type="color"] {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1.1em;
      margin-right: 4px;
      min-width: 48px;
    }
    .recording {
      color: #d32f2f;
      font-weight: bold;
      margin-left: 8px;
      animation: blink 1s steps(2, start) infinite;
    }
    @keyframes blink {
      to {
        visibility: hidden;
      }
    }
    @media (max-width: 600px) {
      .chat-container {
        padding: 8px;
      }
      .input-area {
        gap: 6px;
      }
      .input-area input[type="text"] {
        padding: 8px;
        font-size: 1em;
      }
      .input-area button {
        padding: 8px 12px;
        font-size: 1em;
      }
    }
    /* Estilo para janela privada */
    .private-chat {
      position: fixed;
      right: 30px;
      bottom: 60px;
      width: 370px;
      background: rgba(255,255,255,0.98); /* Fundo branco moderno */
      border: 2px solid #2563eb;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      height: 440px;
      animation: fadeInUp 0.3s;
      transition: height 0.2s, width 0.2s, bottom 0.2s;
      overflow: hidden;
      /* Removido o fundo de favela */
      /* background-image: none; */
      background-size: cover;
      background-position: center;
      border-top: 6px solid #2563eb;
      backdrop-filter: blur(2px);
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(80px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .private-header {
      background: linear-gradient(90deg, #2563eb 60%, #60a5fa 100%);
      color: #fff;
      padding: 14px 20px;
      border-radius: 18px 18px 0 0;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      letter-spacing: 0.5px;
      font-size: 1.13em;
    }
    .private-header .header-btns {
      display: flex;
      gap: 8px;
    }
    .private-header button {
      background: rgba(255,255,255,0.18);
      border: none;
      color: #fff;
      font-size: 1.3em;
      cursor: pointer;
      padding: 0 6px;
      height: 32px;
      width: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: background 0.2s;
    }
    .private-header button:hover {
      background: #1746a0;
    }
    .private-messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      background: #f6f8fa;
      font-size: 1.08em;
      transition: height 0.2s;
      border-radius: 0 0 12px 12px;
      margin-bottom: 0;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04) inset;
    }
    .private-input-area {
      display: flex;
      gap: 8px;
      padding: 12px 10px;
      border-top: 1px solid #eee;
      background: #fafdff;
      transition: height 0.2s;
      align-items: center;
      border-radius: 0 0 18px 18px;
      box-shadow: 0 -1px 4px rgba(0,0,0,0.03) inset;
    }
    .private-input-area input[type="text"] {
      flex: 1 1 0;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #b3c6e0;
      font-size: 1.08em;
      min-width: 0;
      background: #f7faff;
      transition: border 0.2s;
    }
    .private-input-area input[type="text"]:focus {
      border: 1.5px solid #2563eb;
      outline: none;
      background: #fff;
    }
    .private-input-area label {
      display: flex;
      align-items: center;
      cursor: pointer;
      margin: 0 2px;
      border-radius: 6px;
      transition: background 0.2s;
      padding: 2px 4px;
    }
    .private-input-area label:hover {
      background: #e3e8f7;
    }
    .private-input-area label span {
      font-size: 1.5em;
      padding: 0 4px;
      line-height: 1;
      color: #2563eb;
      transition: color 0.2s;
    }
    .private-input-area label:hover span {
      color: #1746a0;
    }
    .private-input-area input[type="file"] {
      display: none;
    }
    .private-input-area button[type="submit"] {
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      background: #2563eb;
      color: #fff;
      font-size: 1.1em;
      cursor: pointer;
      transition: background 0.2s;
      margin-left: 2px;
      height: 40px;
      display: flex;
      align-items: center;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .private-input-area button[type="submit"]:hover {
      background: #60a5fa;
      color: #222;
    }
    .private-file-message {
      margin: 8px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .private-file-message a {
      color: #2563eb;
      text-decoration: underline;
      word-break: break-all;
    }
    .private-file-message img {
      max-width: 120px;
      max-height: 120px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    }
    .minimized {
      height: 46px !important;
      width: 220px !important;
      overflow: hidden;
      min-width: 180px;
      max-width: 370px;
      border-radius: 18px;
        }
    .minimized .private-messages,
    .minimized .private-input-area {
      display: none !important;
    }
    #online-users {
      text-align: right;
      font-size: 1.18em;
      color: #2563eb;
      margin-bottom: 8px;
      font-family: 'Permanent Marker', cursive, sans-serif;
      letter-spacing: 1px;
      text-shadow: 1px 1px 0 #fff, 2px 2px 2px #0002;
      user-select: none;
    }

    /* Estilos para o box do tempo */
    #weather-box {
      position: fixed;
      right: 36px;
      bottom: 24px;
      background: rgba(255,255,255,0.93);
      border-radius: 12px;
      box-shadow: 0 2px 8px #0002;
      padding: 12px 18px;
      font-family: 'Permanent Marker', cursive, sans-serif;
      font-size: 1.08em;
      color: #2563eb;
      z-index: 2000;
      display: flex;
      align-items: center;
      gap: 8px;
    }
  </style>
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init('SEU_USER_ID'); // Substitua pelo seu userID do EmailJS
    })();
  </script>
</head>
<body>
  <div class="chat-container">
    <!-- Contador de pessoas online com emoticon e fonte grafite -->
    <div id="online-users">
      <!-- Removido o emoticon de grupo üë• -->
      <span id="onlineCount">1</span>
      <span style="font-size:1.2em;">üßë</span>
      <span id="onlineText">pessoa online</span>
    </div>
    <div class="messages" id="messages"></div>
    <div class="input-area">
      <select id="emojiSelect" title="Escolha um emoji">
        <option value="üòÄ">üòÄ</option>
        <option value="üòé">üòé</option>
        <option value="üòÇ">üòÇ</option>
        <option value="üòç">üòç</option>
        <option value="ü§©">ü§©</option>
        <option value="ü•≥">ü•≥</option>
        <option value="üòá">üòá</option>
        <option value="ü§†">ü§†</option>
        <option value="üëΩ">üëΩ</option>
        <option value="ü¶Å">ü¶Å</option>
        <option value="üê±">üê±</option>
        <option value="üê∂">üê∂</option>
        <option value="‚öΩ">‚öΩ</option>
        <option value="üéÆ">üéÆ</option>
        <option value="üé§">üé§</option>
      </select>
      <input type="color" id="colorPicker" value="#2563eb" title="Escolha a cor do nome">
      <input type="text" id="username" placeholder="Seu nome" maxlength="16">
      <input type="text" id="messageInput" placeholder="Digite sua mensagem...">
      <button onclick="sendMessage()">Enviar</button>
      <button id="audioBtn" type="button">üé§ √Åudio</button>
      <span id="recordingStatus" style="display:none;" class="recording">Gravando...</span>
    </div>
  </div>
  <div id="weather-box" style="
  position: fixed;
  right: 36px;
  bottom: 24px;
  background: rgba(255,255,255,0.93);
  border-radius: 12px;
  box-shadow: 0 2px 8px #0002;
  padding: 12px 18px;
  font-family: 'Permanent Marker', cursive, sans-serif;
  font-size: 1.08em;
  color: #2563eb;
  z-index: 2000;
  display: flex;
  align-items: center;
  gap: 8px;
">
  <span id="weather-temp">--¬∞C</span>
  <span id="weather-desc"></span>
  <span id="weather-icon"></span>
  <span style="font-size:1.1em;">BH</span>
</div>
  <script>
    // Simula√ß√£o de chat local (n√£o √© em tempo real entre v√°rios usu√°rios reais)
    const messagesDiv = document.getElementById('messages');
    const usernameInput = document.getElementById('username');
    const messageInput = document.getElementById('messageInput');
    const emojiSelect = document.getElementById('emojiSelect');
    const colorPicker = document.getElementById('colorPicker');
    const audioBtn = document.getElementById('audioBtn');
    const recordingStatus = document.getElementById('recordingStatus');

    let mainMessageCount = 0;

    function sendMessage() {
      const username = usernameInput.value.trim() || "An√¥nimo";
      const text = messageInput.value.trim();
      const emoji = emojiSelect.value;
      const color = colorPicker.value;
      if (!text) return;
      const msgElem = document.createElement('div');
      msgElem.className = 'message';
      msgElem.innerHTML = `<span class="username" style="color:${color}" data-username="${username}">${emoji} ${username}:</span> ${text}`;
      messagesDiv.appendChild(msgElem);
      messageInput.value = '';
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      // Contador de mensagens principais
      mainMessageCount++;
      if (mainMessageCount % 10 === 0) {
        showAdPrompt();
      }
    }

    function showAdPrompt() {
      const adElem = document.createElement('div');
      adElem.className = 'message';
      adElem.style.background = '#fffbe8';
      adElem.style.border = '1px solid #ffe066';
      adElem.style.borderRadius = '8px';
      adElem.style.padding = '12px';
      adElem.style.margin = '16px 0';
      adElem.style.textAlign = 'center';
      adElem.style.fontWeight = 'bold';
      adElem.innerHTML = `
        üéØ Quer anunciar seu neg√≥cio no chat?
        <button id="adBtn" style="margin-left:8px;padding:6px 14px;border-radius:6px;border:none;background:#2563eb;color:#fff;cursor:pointer;">
          Anunciar
        </button>
      `;
      messagesDiv.appendChild(adElem);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      document.getElementById('adBtn').onclick = function() {
        if (document.getElementById('adModal')) return; // Evita m√∫ltiplos modais

        const modal = document.createElement('div');
        modal.id = 'adModal';
        modal.style.position = 'fixed';
        modal.style.top = '0';
        modal.style.left = '0';
        modal.style.width = '100vw';
        modal.style.height = '100vh';
        modal.style.background = 'rgba(0,0,0,0.35)';
        modal.style.display = 'flex';
        modal.style.alignItems = 'center';
        modal.style.justifyContent = 'center';
        modal.style.zIndex = '9999';

        modal.innerHTML = `
          <div style="background:#fff; border-radius:12px; padding:32px 28px; box-shadow:0 8px 32px #0003; min-width:320px; max-width:90vw; font-family:Arial,sans-serif; position:relative;">
            <button id="closeAdModal" style="position:absolute;top:10px;right:14px;background:none;border:none;font-size:1.4em;cursor:pointer;color:#2563eb;">‚úñ</button>
            <h2 style="margin-top:0;color:#2563eb;font-family:'Permanent Marker',cursive,sans-serif;font-size:1.3em;">Anunciar no Chat</h2>
            <form id="adForm" style="display:flex;flex-direction:column;gap:14px;">
              <input type="text" id="adNome" placeholder="Seu nome" required style="padding:10px;border-radius:6px;border:1px solid #ccc;font-size:1em;">
              <input type="tel" id="adTelefone" placeholder="Telefone" required style="padding:10px;border-radius:6px;border:1px solid #ccc;font-size:1em;">
              <input type="email" id="adEmail" placeholder="E-mail" required style="padding:10px;border-radius:6px;border:1px solid #ccc;font-size:1em;">
              <button type="submit" style="padding:12px 0;border-radius:6px;border:none;background:#2563eb;color:#fff;font-size:1.1em;cursor:pointer;margin-top:8px;">Enviar</button>
            </form>
          </div>
        `;
        document.body.appendChild(modal);

        document.getElementById('closeAdModal').onclick = () => modal.remove();

        // Substitua o onsubmit do formul√°rio pelo c√≥digo abaixo:
        document.getElementById('adForm').onsubmit = function(e) {
          e.preventDefault();
          const nome = document.getElementById('adNome').value.trim();
          const telefone = document.getElementById('adTelefone').value.trim();
          const email = document.getElementById('adEmail').value.trim();
          if (!nome || !telefone || !email) {
            alert('Preencha todos os campos!');
            return;
          }

          emailjs.send('service_ec1f9tb', 'template_apgrk0k', {
            nome: nome,
            telefone: telefone,
            email: email
          }).then(function(response) {
            alert('Dados enviados com sucesso!');
            modal.remove();
          }, function(error) {
            alert('Erro ao enviar. Tente novamente.');
          });
        };
      };
    }

    // Permite enviar com Enter
    messageInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') sendMessage();
    });
    usernameInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') messageInput.focus();
    });

    // √Åudio
    let mediaRecorder;
    let audioChunks = [];
    let audioTimeout;

    audioBtn.addEventListener('click', async function() {
      if (mediaRecorder && mediaRecorder.state === "recording") {
        stopRecording();
        return;
      }
      // Solicita permiss√£o do microfone
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        mediaRecorder.ondataavailable = e => {
          if (e.data.size > 0) audioChunks.push(e.data);
        };
        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
          const audioUrl = URL.createObjectURL(audioBlob);
          addAudioMessage(audioUrl);
        };
        mediaRecorder.start();
        recordingStatus.style.display = "inline";
        audioBtn.textContent = "‚èπÔ∏è Parar";
        // Para automaticamente ap√≥s 10 segundos
        audioTimeout = setTimeout(() => {
          if (mediaRecorder && mediaRecorder.state === "recording") {
            stopRecording();
          }
        }, 10000);
      } catch (err) {
        alert("Permiss√£o do microfone negada ou n√£o suportada.");
      }
    });

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state === "recording") {
        mediaRecorder.stop();
        recordingStatus.style.display = "none";
        audioBtn.textContent = "üé§ √Åudio";
        clearTimeout(audioTimeout);
      }
    }

    function addAudioMessage(audioUrl) {
      const username = usernameInput.value.trim() || "An√¥nimo";
      const emoji = emojiSelect.value;
      const color = colorPicker.value;
      const msgElem = document.createElement('div');
      msgElem.className = 'audio-message';
      msgElem.innerHTML = `<span class="username" style="color:${color}" data-username="${username}">${emoji} ${username}:</span>
        <audio controls src="${audioUrl}" style="vertical-align:middle;"></audio>`;
      messagesDiv.appendChild(msgElem);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // Clique no nome do usu√°rio para abrir chat privado
    messagesDiv.addEventListener('click', function(e) {
      if (e.target.classList.contains('username')) {
        const privateUser = e.target.getAttribute('data-username');
        openPrivateChat(privateUser);
      }
    });

    // Gerenciamento de chats privados (local, simulado)
    let privateChats = {};

    function openPrivateChat(user) {
      if (privateChats[user]) {
        // J√° existe, traz para frente
        privateChats[user].style.display = 'flex';
        privateChats[user].classList.remove('minimized');
        return;
      }
      // Cria janela privada
      const chatBox = document.createElement('div');
      chatBox.className = 'private-chat';
      chatBox.innerHTML = `
        <div class="private-header">
          <span>Conversa privada com ${user}</span>
          <span class="header-btns">
            <button title="Minimizar" type="button" onclick="minimizePrivateChat('${user}')">_</button>
            <button title="Fechar" type="button" onclick="this.parentElement.parentElement.parentElement.style.display='none'">‚úñ</button>
          </span>
        </div>
        <div class="private-messages" id="private-messages-${user}"></div>
        <form class="private-input-area" onsubmit="event.preventDefault(); sendPrivateMessage('${user}');">
          <input type="text" placeholder="Digite sua mensagem..." id="private-input-${user}">
          <label for="private-file-${user}">
            <span title="Enviar arquivo">üìé</span>
            <input type="file" id="private-file-${user}" title="Enviar arquivo">
          </label>
          <button type="submit">Enviar</button>
        </form>
      `;
      document.body.appendChild(chatBox);
      privateChats[user] = chatBox;

      // Minimizar fun√ß√£o global
      window.minimizePrivateChat = function(u) {
        if (privateChats[u]) {
          privateChats[u].classList.toggle('minimized');
        }
      };

      // Permite enviar com Enter
      chatBox.querySelector(`#private-input-${user}`).addEventListener('keydown', function(e) {
        if (e.key === 'Enter') sendPrivateMessage(user);
      });

      // Envio de arquivo
      chatBox.querySelector(`#private-file-${user}`).addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const messagesBox = document.getElementById(`private-messages-${user}`);
        const myName = usernameInput.value.trim() || "Voc√™";
        const fileUrl = URL.createObjectURL(file);
        let fileHtml = '';
        if (file.type.startsWith('image/')) {
          fileHtml = `<img src="${fileUrl}" alt="imagem">`;
        } else {
          fileHtml = `<a href="${fileUrl}" download="${file.name}">${file.name}</a>`;
        }
        const msgDiv = document.createElement('div');
        msgDiv.className = 'private-file-message';
        msgDiv.innerHTML = `<b>${myName}:</b> ${fileHtml}`;
        messagesBox.appendChild(msgDiv);
        messagesBox.scrollTop = messagesBox.scrollHeight;
        e.target.value = '';
      });
    }

    function sendPrivateMessage(user) {
      const input = document.getElementById(`private-input-${user}`);
      const msg = input.value.trim();
      if (!msg) return;
      const messagesBox = document.getElementById(`private-messages-${user}`);
      const myName = usernameInput.value.trim() || "Voc√™";
      messagesBox.innerHTML += `<div><b>${myName}:</b> ${msg}</div>`;
      input.value = '';
      messagesBox.scrollTop = messagesBox.scrollHeight;
    }

    // Simula√ß√£o de usu√°rios online (local, apenas para efeito visual)
    // Em um sistema real, seria necess√°rio backend para contar usu√°rios reais
    function updateOnlineCount() {
      // Simula 1 usu√°rio (voc√™). Para testes, altere o valor abaixo:
      const onlineCount = 1;
      document.getElementById('onlineCount').textContent = onlineCount;
      document.getElementById('onlineText').textContent =
        onlineCount === 1 ? 'pessoa online' : 'pessoas online';
    }
    updateOnlineCount();

    async function updateWeather() {
  try {
    // Use sua pr√≥pria chave da OpenWeatherMap se quiser mais requisi√ß√µes
    const apiKey = 'b6907d289e10d714a6e88b30761fae22'; // Chave demo (limite baixo)
    const url = `https://api.openweathermap.org/data/2.5/weather?q=Belo%20Horizonte,BR&appid=${apiKey}&units=metric&lang=pt_br`;
    const res = await fetch(url);
    const data = await res.json();
    if (data.main && data.weather) {
      document.getElementById('weather-temp').textContent = `${Math.round(data.main.temp)}¬∞C`;
      document.getElementById('weather-desc').textContent = data.weather[0].description;
      document.getElementById('weather-icon').innerHTML =
        `<img src="https://openweathermap.org/img/wn/${data.weather[0].icon}.png" alt="icon" style="vertical-align:middle;width:28px;height:28px;">`;
    } else {
      document.getElementById('weather-temp').textContent = '--¬∞C';
      document.getElementById('weather-desc').textContent = '';
      document.getElementById('weather-icon').innerHTML = '';
    }
  } catch {
    document.getElementById('weather-temp').textContent = '--¬∞C';
    document.getElementById('weather-desc').textContent = '';
    document.getElementById('weather-icon').innerHTML = '';
  }
}
updateWeather();
setInterval(updateWeather, 600000); // Atualiza a cada 10 minutos
  </script>
</body>
</html>